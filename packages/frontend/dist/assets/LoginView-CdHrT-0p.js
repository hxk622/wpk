import{_ as h,i as k,r as g,c as y,b as r,a as i,w as c,d,g as x,h as C,j as f,s as t}from"./index-DuysnCwA.js";import{u as B}from"./user-aMWrx1op.js";import{u as I}from"./user-CBVw-EAl.js";import{l as a}from"./logger-BnKYzyre.js";import"./axios-DCPBCOZw.js";const L={class:"login"},N={class:"login-container"},T={class:"login-form"},U={class:"login-register"},q={__name:"LoginView",setup(R){const w=x(),_=B(),o=k({username:"",password:""}),m=g(!1),p=g(!1),v=async()=>{try{if(!o.username.trim()){t("请输入账号"),a.warn("登录尝试：未输入账号");return}if(!o.password.trim()){t("请输入密码"),a.warn("登录尝试：未输入密码");return}p.value=!0,a.info("开始登录尝试",{account:o.username});let s={password:o.password};const e=o.username.trim();let l="";e.includes("@")?(s.email=e,l="email",a.debug("登录尝试：使用邮箱登录",{email:e})):/^1[3-9]\d{9}$/.test(e)?(s.phone=e,l="phone",a.debug("登录尝试：使用手机号登录",{phone:e})):(s.username=e,l="username",a.debug("登录尝试：使用用户名登录",{username:e}));const n=await I.login(s);n&&n.user&&n.token?(_.login(n.user,n.token),t("登录成功"),w.push("/"),a.info("登录成功",{userId:n.user.id,username:n.user.username})):(t("登录失败，请检查账号密码"),a.warn("登录失败：服务器返回无效响应"))}catch(s){console.error("登录失败:",s),s.message?t(s.message):s.response&&s.response.data&&s.response.data.message?t(s.response.data.message):t("登录失败，请稍后重试")}finally{p.value=!1}};return(s,e)=>{const l=d("van-field"),n=d("van-cell-group"),V=d("van-button"),b=d("router-link");return C(),y("div",L,[r("div",N,[e[6]||(e[6]=r("div",{class:"login-header"},[r("h2",{class:"login-title"},"德州扑克"),r("p",{class:"login-subtitle"},"请登录你的账号")],-1)),r("div",T,[i(n,{inset:""},{default:c(()=>[i(l,{modelValue:o.username,"onUpdate:modelValue":e[0]||(e[0]=u=>o.username=u),name:"username",label:"账号",placeholder:"请输入用户名、邮箱或手机号","left-icon":"contact",rules:[{required:!0,message:"请输入账号"}]},null,8,["modelValue"]),i(l,{modelValue:o.password,"onUpdate:modelValue":e[1]||(e[1]=u=>o.password=u),name:"password",label:"密码",type:"password",placeholder:"请输入密码","left-icon":"locked",rules:[{required:!0,message:"请输入密码"}],"show-password":m.value,"right-icon":"eye-o",onClickRightIcon:e[2]||(e[2]=u=>m.value=!m.value)},null,8,["modelValue","show-password"])]),_:1}),i(V,{type:"primary",class:"login-btn",loading:p.value,onClick:v},{default:c(()=>[...e[3]||(e[3]=[f(" 登录 ",-1)])]),_:1},8,["loading"]),r("div",U,[e[5]||(e[5]=r("span",null,"还没有账号？",-1)),i(b,{to:"/register"},{default:c(()=>[...e[4]||(e[4]=[f("立即注册",-1)])]),_:1})])])])])}}},E=h(q,[["__scopeId","data-v-4a5dfd3e"]]);export{E as default};
