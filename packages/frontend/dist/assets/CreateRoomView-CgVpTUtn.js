import{_ as M,i as R,r as g,c as T,a as t,b as l,d as m,w as c,g as $,h as q,u as n,I as r,t as h,j as z,s as d,k as A,l as N}from"./index-DuysnCwA.js";import{u as L}from"./user-aMWrx1op.js";import{r as E}from"./room-MDMjkgn2.js";import"./axios-DCPBCOZw.js";import"./logger-BnKYzyre.js";const G={class:"create-room"},O={class:"create-room-container"},j={class:"card-form"},D={class:"form-item"},F={class:"form-label"},H={class:"form-item"},J={class:"form-label"},K={class:"form-item"},Q={class:"form-label"},W={class:"form-item"},X={class:"form-label"},Y={class:"picker-value"},Z={class:"form-item"},ee={class:"form-label"},oe={class:"picker-value"},le={class:"form-item switch-item"},te={class:"form-label"},se={class:"create-button-container"},ae={__name:"CreateRoomView",setup(ne){const _=$(),f=L(),x=[{text:"2人",value:2},{text:"4人",value:4},{text:"6人",value:6},{text:"8人",value:8},{text:"9人",value:9},{text:"10人",value:10}],w=[{text:"无限注",value:"no_limit"},{text:"有限注",value:"limit"},{text:"固定注",value:"pot_limit"}],o=R({roomName:"",smallBlind:10,bigBlind:20,maxPlayers:6,gameMode:"no_limit",allowSpectators:!0});console.log("Username:",f.getUsername),o.roomName=f.getUsername?`${f.getUsername}创建的房间`:"新建房间",console.log("Room name:",o.roomName);const v=g(!1),u=g(!1),p=g(!1),V=()=>{const a=x.find(e=>e.value===o.maxPlayers);return a?a.text:"6人"},C=()=>{const a=w.find(e=>e.value===o.gameMode);return a?a.text:"无限注"},P=()=>{_.back()},y=async()=>{try{if(console.log("Create room button clicked"),console.log("Current room form:",o),!o.roomName){d("请输入房间名");return}if(!o.smallBlind||o.smallBlind<1){d("请输入有效的小盲注金额");return}if(!o.bigBlind||o.bigBlind<2){d("请输入有效的大盲注金额");return}const a=Number(o.smallBlind);if(Number(o.bigBlind)!==a*2){d("大盲注必须是小盲注的两倍");return}v.value=!0,A({message:"创建房间中...",forbidClick:!0}),console.log("Calling createRoom API with data:",{name:o.roomName,room_type:o.allowSpectators?"public":"private",small_blind:parseInt(o.smallBlind),big_blind:parseInt(o.bigBlind),max_players:o.maxPlayers,table_type:"cash"});const i=await E.createRoom({name:o.roomName,room_type:o.allowSpectators?"public":"private",small_blind:parseInt(o.smallBlind),big_blind:parseInt(o.bigBlind),max_players:o.maxPlayers,table_type:"cash"});console.log("API response:",i),N(),i&&i.room?(d("房间创建成功"),_.push(`/room/${i.room.id}`)):d(i?.message||"房间创建失败")}catch(a){N(),console.error("创建房间失败:",a),console.error("Error details:",a.response?.data||a.message),d("房间创建失败，请稍后重试")}finally{v.value=!1}};return(a,e)=>{const i=m("van-nav-bar"),b=m("van-field"),B=m("van-picker"),k=m("van-popup"),U=m("van-switch"),I=m("van-button"),S=m("van-form");return q(),T("div",G,[t(i,{title:"创建房间","left-text":"返回","left-arrow":"",onClickLeft:P,background:"#1a1a2e","title-style":"color: #ffd700","left-text-style":"color: #ffd700"}),l("div",O,[t(S,{onSubmit:y},{default:c(()=>[l("div",j,[l("div",D,[l("label",F,[t(n(r),{name:"chat-o",color:"#ffd700"}),e[10]||(e[10]=l("span",null,"房间名",-1))]),t(b,{modelValue:o.roomName,"onUpdate:modelValue":e[0]||(e[0]=s=>o.roomName=s),name:"roomName",placeholder:"请输入房间名",type:"text",class:"form-field",rules:[{required:!0,message:"请输入房间名"}]},null,8,["modelValue"])]),l("div",H,[l("label",J,[t(n(r),{name:"coin",color:"#ffd700"}),e[11]||(e[11]=l("span",null,"小盲注",-1))]),t(b,{modelValue:o.smallBlind,"onUpdate:modelValue":e[1]||(e[1]=s=>o.smallBlind=s),name:"smallBlind",placeholder:"请输入小盲注金额",type:"number",class:"form-field",rules:[{required:!0,message:"请输入小盲注金额"},{min:1,message:"小盲注金额不能小于1"}]},null,8,["modelValue"])]),l("div",K,[l("label",Q,[t(n(r),{name:"coin",color:"#ffd700"}),e[12]||(e[12]=l("span",null,"大盲注",-1))]),t(b,{modelValue:o.bigBlind,"onUpdate:modelValue":e[2]||(e[2]=s=>o.bigBlind=s),name:"bigBlind",placeholder:"请输入大盲注金额",type:"number",class:"form-field",rules:[{required:!0,message:"请输入大盲注金额"},{min:2,message:"大盲注金额不能小于2"}]},null,8,["modelValue"])]),l("div",W,[l("label",X,[t(n(r),{name:"people-o",color:"#ffd700"}),e[13]||(e[13]=l("span",null,"最大玩家数量",-1))]),l("div",{class:"picker-wrapper",onClick:e[3]||(e[3]=s=>u.value=!0)},[l("span",Y,h(V()),1),t(n(r),{name:"arrow-down",color:"#ffd700"}),e[14]||(e[14]=l("div",{class:"picker-hint"},"点击选择人数 (2-10人)",-1))]),t(k,{show:u.value,"onUpdate:show":e[5]||(e[5]=s=>u.value=s),round:"",position:"bottom",style:{height:"400px"}},{default:c(()=>[t(B,{columns:x,onConfirm:e[4]||(e[4]=s=>{o.maxPlayers=s.value,u.value=!1}),"show-toolbar":"","toolbar-position":"bottom",title:"选择最大玩家数量",height:300,"visible-item-count":5})]),_:1},8,["show"])]),l("div",Z,[l("label",ee,[t(n(r),{name:"gamepad-o",color:"#ffd700"}),e[15]||(e[15]=l("span",null,"游戏模式",-1))]),l("div",{class:"picker-wrapper",onClick:e[6]||(e[6]=s=>p.value=!0)},[l("span",oe,h(C()),1),t(n(r),{name:"arrow",color:"#888"})]),t(k,{show:p.value,"onUpdate:show":e[8]||(e[8]=s=>p.value=s),round:"",position:"bottom",style:{height:"400px"}},{default:c(()=>[t(B,{columns:w,onConfirm:e[7]||(e[7]=s=>{o.gameMode=s.value,p.value=!1}),"show-toolbar":"","toolbar-position":"bottom",title:"选择游戏模式",height:300,"visible-item-count":3})]),_:1},8,["show"])]),l("div",le,[l("label",te,[t(n(r),{name:"eye-o",color:"#ffd700"}),e[16]||(e[16]=l("span",null,"允许观看",-1))]),t(U,{modelValue:o.allowSpectators,"onUpdate:modelValue":e[9]||(e[9]=s=>o.allowSpectators=s),size:"28px","active-color":"#ffd700","inactive-color":"#444"},null,8,["modelValue"])])]),l("div",se,[e[18]||(e[18]=l("div",{class:"create-button-hint"},"点击下方按钮创建房间",-1)),t(I,{type:"primary",class:"create-room-btn",onClick:y,loading:v.value,size:"large"},{default:c(()=>[t(n(r),{name:"plus-circle",size:"22"}),e[17]||(e[17]=z(" 创建房间 ",-1))]),_:1},8,["loading"])])]),_:1})])])}}},pe=M(ae,[["__scopeId","data-v-9b8ef93b"]]);export{pe as default};
