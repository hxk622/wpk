import{E as Ne,_ as Me,y as De,z as P,r as D,i as X,G as me,o as Ge,H as Le,c as p,b as s,a as f,d as w,t as l,D as N,B as b,C as ve,w as S,F as j,f as q,s as _,g as He,h as d,j as C,J as Ue,u as E,K as Ve}from"./index-DuysnCwA.js";import{g as G}from"./game-CbA6aoiT.js";import{a as J}from"./axios-DCPBCOZw.js";import{u as ze}from"./user-aMWrx1op.js";import"./logger-BnKYzyre.js";const ye={getAiSuggestions:(c,o)=>J.get(`/ai/${c}/suggestions`,{params:o}),analyzeHand:(c,o)=>J.post(`/ai/${c}/analyze-hand`,{holeCards:o}),calculateOdds:(c,o,u)=>J.post(`/ai/${c}/calculate-odds`,{holeCards:o,communityCards:u}),analyzeOpponent:(c,o)=>J.get(`/ai/${c}/analyze-opponent/${o}`),setAiMode:(c,o)=>J.post(`/ai/${c}/set-mode`,{mode:o})},$e=Ne("chat",{state:()=>({messages:[],inputMessage:"",showChat:!0,chatType:"room",privateChatUserId:null}),getters:{getRoomMessages:c=>c.messages.filter(o=>o.type==="room"),getPrivateMessages:c=>o=>c.messages.filter(u=>u.type==="private"&&(u.senderId===o&&u.receiverId===c.privateChatUserId||u.senderId===c.privateChatUserId&&u.receiverId===o)),getLatestMessages:c=>(o=20)=>[...c.messages].reverse().slice(0,o).reverse()},actions:{addMessage(c){this.messages.push({id:Date.now()+Math.random().toString(36).substring(2,9),timestamp:new Date().toISOString(),...c})},sendRoomMessage(c,o,u){const m={type:"room",content:c,senderId:o,senderName:u};return this.addMessage(m),m},sendPrivateMessage(c,o,u,m){const k={type:"private",content:c,senderId:o,senderName:u,receiverId:m};return this.addMessage(k),k},setInputMessage(c){this.inputMessage=c},clearInputMessage(){this.inputMessage=""},toggleChat(){this.showChat=!this.showChat},setChatType(c,o=null){this.chatType=c,c==="private"&&o&&(this.privateChatUserId=o)},clearMessages(){this.messages=[]}}});class Fe{constructor(){this.socket=null,this.isConnected=!1,this.eventHandlers={},this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=1e3,this.url="ws://localhost:3000"}connect(){if(this.socket&&this.isConnected)return;const o=localStorage.getItem("token");try{this.socket=new WebSocket(this.url,[o]),this.socket.onopen=()=>{console.log("WebSocketè¿æ¥æˆåŠŸ"),this.isConnected=!0,this.reconnectAttempts=0},this.socket.onmessage=u=>{try{const m=JSON.parse(u.data),k=m.type,K=m.data;this.eventHandlers[k]&&this.eventHandlers[k].forEach(M=>{M(K)})}catch(m){console.error("è§£æWebSocketæ¶ˆæ¯é”™è¯¯:",m)}},this.socket.onerror=u=>{console.error("WebSocketè¿æ¥é”™è¯¯:",u),this.isConnected=!1},this.socket.onclose=u=>{console.log("WebSocketæ–­å¼€è¿æ¥:",u.code,u.reason),this.isConnected=!1,this.attemptReconnect()}}catch(u){console.error("åˆ›å»ºWebSocketè¿æ¥å¤±è´¥:",u),this.isConnected=!1}}attemptReconnect(){this.reconnectAttempts<this.maxReconnectAttempts?(this.reconnectAttempts++,console.log(`WebSocketå°è¯•é‡è¿ï¼Œæ¬¡æ•°: ${this.reconnectAttempts}`),setTimeout(()=>{this.connect()},this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1))):console.error("WebSocketé‡è¿å¤±è´¥")}disconnect(){this.socket&&(this.socket.close(),this.socket=null,this.isConnected=!1,this.eventHandlers={},this.reconnectAttempts=0)}emit(o,u){if(this.socket&&this.isConnected){const m={type:o,data:u};this.socket.send(JSON.stringify(m))}else console.error("WebSocketæœªè¿æ¥ï¼Œæ— æ³•å‘é€äº‹ä»¶:",o)}on(o,u){this.eventHandlers[o]||(this.eventHandlers[o]=[]),this.eventHandlers[o].push(u)}off(o,u){this.eventHandlers[o]&&(u?this.eventHandlers[o]=this.eventHandlers[o].filter(m=>m!==u):this.eventHandlers[o]=[])}getConnectionStatus(){return this.isConnected}getSocket(){return this.socket}}const y=new Fe,We={class:"game-container"},je={class:"top-status"},qe={class:"game-header"},Je={class:"game-status"},Ke={class:"status-item"},Ye={class:"value"},Qe={class:"status-item"},Xe={class:"status-item"},Ze={class:"value"},es={class:"status-item"},ss={class:"value"},ts={class:"game-controls-top"},as={class:"pot-info"},ns={class:"value"},is={key:0,class:"game-action-buttons"},ls={class:"game-table"},os={class:"player-seats"},rs={key:0,class:"player-info"},ds={class:"player-avatar"},cs={class:"player-name"},us={class:"player-stack"},ps={class:"stack-value"},ms={key:0,class:"player-bet"},vs={class:"bet-value"},ys={key:1,class:"dealer-badge"},fs={key:2,class:"blind-badge small"},hs={key:3,class:"blind-badge big"},_s=["onClick"],gs={key:1,class:"empty-seat"},bs={class:"community-cards"},Ss={key:0,class:"card-content"},Cs={class:"card-value"},ks={key:0,class:"game-result"},As={class:"result-content"},ws={key:0,class:"winner-info"},Is={class:"winner-name"},Bs={class:"winner-prize"},Rs={key:1,class:"showdown-info"},Ps={class:"player-name"},Es={class:"player-hand"},xs={class:"player-rank"},Os={class:"pot-display"},Ts={class:"pot-amount"},Ns={class:"player-cards"},Ms={class:"cards-container"},Ds={class:"card-content"},Gs={class:"card-value"},Ls={key:0,class:"ai-analysis-result"},Hs={class:"analysis-content"},Us={class:"hand-strength"},Vs={class:"value"},zs={class:"recommended-action"},$s={class:"value"},Fs={class:"win-probability"},Ws={class:"value"},js={class:"game-controls"},qs={class:"bet-controls"},Js={key:0,class:"bet-slider"},Ks={class:"bet-amount-display"},Ys={class:"value"},Qs={key:1,class:"bet-info"},Xs={class:"info-item"},Zs={class:"value"},et={class:"info-item"},st={class:"value"},tt={class:"info-item"},at={class:"value"},nt={class:"info-item"},it={class:"value"},lt={class:"bet-quick-buttons"},ot={class:"action-buttons"},rt={class:"bottom-bar"},dt={class:"chat-section"},ct={class:"chat-type-tabs"},ut={class:"chat-messages"},pt={class:"message-content"},mt={class:"message-header"},vt={class:"message-sender"},yt={class:"message-time"},ft={class:"message-text"},ht={key:0,class:"message-type-indicator"},_t={class:"chat-input"},gt={class:"ai-assist-section"},bt={class:"ai-controls"},St={key:0,class:"ai-analysis"},Ct={class:"analysis-card"},kt={class:"card-content"},At={class:"analysis-item"},wt={class:"item-value"},It={class:"analysis-item"},Bt={class:"item-value"},Rt={class:"analysis-item"},Pt={class:"item-value"},Et={class:"analysis-item"},xt={class:"item-value"},Ot={class:"analysis-item"},Tt={class:"item-value"},Nt={class:"analysis-item"},Mt={class:"item-value"},Dt={key:0,class:"analysis-explanation"},Gt={class:"explanation-text"},Lt={key:1,class:"opponent-analysis"},Ht={class:"analysis-item"},Ut={class:"item-value"},Vt={class:"analysis-item"},zt={class:"item-value"},$t={class:"analysis-item"},Ft={class:"item-value"},Wt={__name:"GameView",setup(c){const o=He(),u=De(),m=u.params.id,k=u.params.id,K=ze(),M=P(()=>K.userInfo),I=P(()=>K.getUserId),A=D(y.getConnectionStatus()),$=D(!1),ie=D(null);let Z=null;const h={WAITING:"waiting",STARTING:"starting",IN_PROGRESS:"in_progress",FINISHED:"finished"},x={PREFLOP:"preflop",FLOP:"flop",TURN:"turn",RIVER:"river",SHOWDOWN:"showdown"},a=X({id:m,status:h.WAITING,statusText:"ç­‰å¾…å¼€å§‹",currentRound:x.PREFLOP,currentRoundText:"ç¿»ç‰Œå‰",currentPlayer:"",currentPlayerId:null,pot:0,totalBet:0,smallBlind:10,bigBlind:20,dealerPosition:0,communityCards:[{suit:"S",value:"A",revealed:!1},{suit:"H",value:"K",revealed:!1},{suit:"D",value:"Q",revealed:!1},{suit:"C",value:"J",revealed:!1},{suit:"S",value:"10",revealed:!1}],roundPot:0,currentBet:0,hasRaised:!1,startTime:null,endTime:null,winner:null}),Y={READY:"ready",IN_GAME:"in_game",FOLDED:"folded",ALL_IN:"all_in"},L=X([{index:0,player:null,isActive:!1,isCurrentPlayer:!1,isDealer:!1,isSmallBlind:!1,isBigBlind:!1,isEmpty:!0,position:"top"},{index:1,player:null,isActive:!1,isCurrentPlayer:!1,isDealer:!1,isSmallBlind:!1,isBigBlind:!1,isEmpty:!0,position:"top-right"},{index:2,player:null,isActive:!1,isCurrentPlayer:!1,isDealer:!1,isSmallBlind:!1,isBigBlind:!1,isEmpty:!0,position:"right"},{index:3,player:null,isActive:!1,isCurrentPlayer:!1,isDealer:!1,isSmallBlind:!1,isBigBlind:!1,isEmpty:!0,position:"bottom-right"},{index:4,player:null,isActive:!1,isCurrentPlayer:!1,isDealer:!1,isSmallBlind:!1,isBigBlind:!1,isEmpty:!0,position:"bottom"},{index:5,player:null,isActive:!1,isCurrentPlayer:!1,isDealer:!1,isSmallBlind:!1,isBigBlind:!1,isEmpty:!0,position:"bottom-left"},{index:6,player:null,isActive:!1,isCurrentPlayer:!1,isDealer:!1,isSmallBlind:!1,isBigBlind:!1,isEmpty:!0,position:"left"},{index:7,player:null,isActive:!1,isCurrentPlayer:!1,isDealer:!1,isSmallBlind:!1,isBigBlind:!1,isEmpty:!0,position:"top-left"},{index:8,player:null,isActive:!1,isCurrentPlayer:!1,isDealer:!1,isSmallBlind:!1,isBigBlind:!1,isEmpty:!0,position:"center"}]),Q=D([]),H=X([{suit:"S",value:"A"},{suit:"H",value:"A"}]),n=X({enabled:!0,realTime:!0,show:!1,loading:!1,handCombination:"ä¸€å¯¹A",handStrength:"æå¼º",winProbability:95,potOdds:"1:2",equity:"85%",impliedOdds:null,recommendedAction:"åŠ æ³¨",explanation:"å½“å‰æ‰‹ç‰Œä¸ºä¸€å¯¹Aï¼Œæ˜¯å¾·å·æ‰‘å…‹ä¸­æœ€å¼ºçš„èµ·æ‰‹ç‰Œä¹‹ä¸€ï¼Œå»ºè®®è¿›è¡ŒåŠ æ³¨ä»¥æ‰©å¤§åº•æ± ã€‚",adviceStrength:3,opponentAnalysis:null}),g=$e(),ee=D(0),B=D(0),R=D(0),U=P(()=>{if(a.status!==h.IN_PROGRESS)return 0;if(a.currentRound===x.PREFLOP)return a.bigBlind;const t=a.currentBet,e=R.value;return e>=t?Math.max(a.bigBlind,t):t-e}),V=P(()=>M?.stack||1e3),z=P(()=>a.status!==h.IN_PROGRESS?0:Math.max(a.bigBlind,a.currentBet)),F=P(()=>a.status!==h.IN_PROGRESS?!1:a.currentBet===0||R.value>=a.currentBet),le=P(()=>a.status!==h.IN_PROGRESS?!1:F.value||V.value>=U.value),oe=P(()=>{if(a.status!==h.IN_PROGRESS)return!1;a.currentBet+z.value;const t=V.value;if(R.value>=a.currentBet)return t>=z.value;const e=a.currentBet-R.value,r=z.value;return e+r<=t}),re=P(()=>a.status!==h.IN_PROGRESS?0:Math.max(0,a.currentBet-R.value)),se=t=>({S:"â™ ",H:"â™¥",D:"â™¦",C:"â™£"})[t]||t,fe=t=>{B.value=Math.min(Math.max(t,U.value),V.value)},te=t=>{if(F.value&&t===0){B.value=0;return}B.value=Math.min(Math.max(t,U.value),V.value)},he=()=>L.find(t=>t.player&&t.player.id===I.value),_e=t=>{switch(t){case x.PREFLOP:a.currentRoundText="ç¿»ç‰Œå‰",a.communityCards.forEach(e=>e.revealed=!1);break;case x.FLOP:a.currentRoundText="ç¿»ç‰Œ",a.communityCards.slice(0,3).forEach(e=>e.revealed=!0);break;case x.TURN:a.currentRoundText="è½¬ç‰Œ",a.communityCards[3].revealed=!0;break;case x.RIVER:a.currentRoundText="æ²³ç‰Œ",a.communityCards[4].revealed=!0;break;case x.SHOWDOWN:a.currentRoundText="æ‘Šç‰Œ",a.communityCards.forEach(e=>e.revealed=!0);break;default:a.currentRoundText="æœªçŸ¥"}a.currentBet=0,a.hasRaised=!1,B.value=0},ge=async()=>{try{if(!A.value){_("ç½‘ç»œè¿æ¥æ–­å¼€ï¼Œæ— æ³•æ“ä½œ");return}await G.startGame(m),_("æ¸¸æˆå¼€å§‹")}catch(t){console.error("å¼€å§‹æ¸¸æˆå¤±è´¥:",t),_("å¼€å§‹æ¸¸æˆå¤±è´¥")}},be=async()=>{try{if(!A.value){_("ç½‘ç»œè¿æ¥æ–­å¼€ï¼Œæ— æ³•æ“ä½œ");return}await G.restartGame(m),a.status=h.IN_PROGRESS,a.currentRound=x.PREFLOP,a.currentRoundText="ç¿»ç‰Œå‰",a.pot=0,a.totalBet=0,a.communityCards={flop:[],turn:null,river:null},Object.assign(H,{card1:null,card2:null}),currentBetAmount.value=0,R.value=0,_("æ¸¸æˆå·²é‡ç½®")}catch(t){console.error("é‡æ–°å¼€å§‹æ¸¸æˆå¤±è´¥:",t),_("é‡æ–°å¼€å§‹æ¸¸æˆå¤±è´¥")}},Se=t=>{if(a.status=h.FINISHED,a.statusText="æ¸¸æˆç»“æŸ",t&&t.winners){const r=`æ¸¸æˆç»“æŸï¼è·èƒœè€…ï¼š${t.winners.map(v=>v.name).join(", ")}`;_(r)}t&&t.showdown&&console.log("æ‘Šç‰Œç»“æœ:",t.showdown)},Ce=async()=>{try{if(!A.value){_("ç½‘ç»œè¿æ¥æ–­å¼€ï¼Œæ— æ³•æ“ä½œ");return}await G.playerAction(m,"fold")}catch(t){console.error("å¼ƒç‰Œå¤±è´¥:",t),_("å¼ƒç‰Œå¤±è´¥")}},ke=async()=>{const t=F.value?"check":"call";try{if(!A.value){_("ç½‘ç»œè¿æ¥æ–­å¼€ï¼Œæ— æ³•æ“ä½œ");return}await G.playerAction(m,t)}catch(e){console.error(t+"å¤±è´¥:",e),_(t+"å¤±è´¥")}},Ae=async()=>{if(B.value<=U.value){_("åŠ æ³¨é‡‘é¢å¿…é¡»å¤§äºè·Ÿæ³¨é‡‘é¢");return}try{if(!A.value){_("ç½‘ç»œè¿æ¥æ–­å¼€ï¼Œæ— æ³•æ“ä½œ");return}await G.playerAction(m,"raise",B.value)}catch(t){console.error("åŠ æ³¨å¤±è´¥:",t),_("åŠ æ³¨å¤±è´¥")}},de=async()=>{if(g.inputMessage.trim())try{let t;g.chatType==="room"?(t=g.sendRoomMessage(g.inputMessage.trim(),I.value,M.value.username),y.emit("chat_message",{message:t.content,roomId:m,userId:I.value,username:M.value.username})):(t=g.sendPrivateMessage(g.inputMessage.trim(),I.value,M.value.username,g.privateChatUserId),y.emit("chat_message",{message:t.content,roomId:m,isPrivate:!0,recipientId:g.privateChatUserId,userId:I.value,username:M.value.username})),g.clearInputMessage()}catch(t){console.error("å‘é€æ¶ˆæ¯å¤±è´¥:",t),_("å‘é€æ¶ˆæ¯å¤±è´¥")}},we=(t,e)=>{g.setChatType("private",t),_(`å¼€å§‹ä¸${e}ç§èŠ`),ee.value=1},Ie=()=>{n.enabled&&n.realTime?W():n.show=!1},W=async()=>{if(n.enabled){n.loading=!0;try{const t=await G.requestAiAnalysis(m,H,a.communityCards);t&&t.analysis?(Object.assign(n,{show:!0,handCombination:t.analysis.handCombination,handStrength:t.analysis.handStrength,winProbability:t.analysis.winProbability,recommendedAction:t.analysis.recommendedAction,explanation:t.analysis.explanation,potOdds:t.analysis.potOdds||null,equity:t.analysis.equity||null}),a.players&&a.players.length>1&&Be(),Re()):(n.show=!0,n.handCombination="ä¸€å¯¹A",n.handStrength="æå¼º",n.winProbability=95,n.potOdds="1:2",n.equity="85%",n.impliedOdds="1:3",n.recommendedAction="åŠ æ³¨",n.explanation="å½“å‰æ‰‹ç‰Œä¸ºä¸€å¯¹Aï¼Œæ˜¯å¾·å·æ‰‘å…‹ä¸­æœ€å¼ºçš„èµ·æ‰‹ç‰Œä¹‹ä¸€ï¼Œå»ºè®®è¿›è¡ŒåŠ æ³¨ä»¥æ‰©å¤§åº•æ± ã€‚",n.opponentAnalysis={opponentName:"å¯¹æ‰‹ç©å®¶",playingStyle:"ä¿å®ˆ",aggressionLevel:"ä½",recentActions:["è·Ÿæ³¨","å¼ƒç‰Œ","è·Ÿæ³¨"]})}catch(t){console.error("AIåˆ†æè¯·æ±‚å¤±è´¥:",t),_("AIåˆ†æè¯·æ±‚å¤±è´¥"),n.show=!0,n.handCombination="ä¸€å¯¹A",n.handStrength="æå¼º",n.winProbability=95,n.potOdds="1:2",n.equity="85%",n.impliedOdds="1:3",n.recommendedAction="åŠ æ³¨",n.explanation="å½“å‰æ‰‹ç‰Œä¸ºä¸€å¯¹Aï¼Œæ˜¯å¾·å·æ‰‘å…‹ä¸­æœ€å¼ºçš„èµ·æ‰‹ç‰Œä¹‹ä¸€ï¼Œå»ºè®®è¿›è¡ŒåŠ æ³¨ä»¥æ‰©å¤§åº•æ± ã€‚",n.opponentAnalysis={opponentName:"å¯¹æ‰‹ç©å®¶",playingStyle:"ä¿å®ˆ",aggressionLevel:"ä½",recentActions:["è·Ÿæ³¨","å¼ƒç‰Œ","è·Ÿæ³¨"]}}finally{n.loading=!1}}},Be=async()=>{try{const t=a.players.filter(e=>e.id!==I.value);if(t.length>0){const e=t[0],r=await ye.analyzeOpponent(m,e.id);r&&r.analysis&&(n.opponentAnalysis={opponentName:e.username,playingStyle:r.analysis.playingStyle,aggressionLevel:r.analysis.aggressionLevel,recentActions:r.analysis.recentActions})}}catch(t){console.error("å¯¹æ‰‹åˆ†æè¯·æ±‚å¤±è´¥:",t)}},Re=async()=>{if(n.enabled)try{const t=await ye.calculateOdds(m,H,a.communityCards);t&&t.odds&&(n.potOdds=t.odds.potOdds,n.equity=t.odds.equity,n.impliedOdds=t.odds.impliedOdds)}catch(t){console.error("èµ”ç‡è®¡ç®—è¯·æ±‚å¤±è´¥:",t)}},ce=t=>{L.forEach(e=>{e.isEmpty=!0}),t.forEach(e=>{let r=L.find(v=>v.player&&v.player.id===e.id);if(r||(r=L.find(v=>v.isEmpty&&v.position!=="center")),r){r.player=e,r.isActive=e.status===Y.IN_GAME||e.status===Y.READY,r.isCurrentPlayer=e.isCurrentPlayer,r.isDealer=e.isDealer,r.isSmallBlind=e.isSmallBlind,r.isBigBlind=e.isBigBlind,r.isEmpty=!1,e.id===I.value&&(R.value=e.bet||0);const v=Q.value.find(O=>O.id===e.id);v?Object.assign(v,e):Q.value.push({...e})}}),L.forEach(e=>{e.player&&!t.find(r=>r.id===e.player.id)&&(e.player=null,e.isActive=!1,e.isCurrentPlayer=!1,e.isDealer=!1,e.isSmallBlind=!1,e.isBigBlind=!1,e.isEmpty=!0)}),Q.value=Q.value.filter(e=>t.find(r=>r.id===e.id))},Pe=async()=>{try{const t=await G.getGameState(m);if(t&&t.data){Object.assign(a,t.data),t.data.players&&ce(t.data.players),t.data.playerCards&&Object.assign(H,t.data.playerCards);const e=he();e&&e.player&&(R.value=e.player.bet||0),n.enabled&&n.realTime&&W()}}catch(t){console.error("åˆå§‹åŒ–æ¸¸æˆå¤±è´¥:",t),_("åˆå§‹åŒ–æ¸¸æˆå¤±è´¥"),o.push(`/room/${k}`)}},Ee=()=>{const t=setInterval(()=>{const e=y.getConnectionStatus();e!==A.value&&(A.value=e,e?($.value=!1,ie.value=null,_("å·²é‡æ–°è¿æ¥åˆ°æ¸¸æˆæœåŠ¡å™¨"),y.emit("join_room",{roomId:k})):$.value||($.value=!0,ie.value="è¿æ¥å·²æ–­å¼€ï¼Œæ­£åœ¨å°è¯•é‡è¿..."))},1e3);return y.connect(),y.emit("join_room",{roomId:k}),y.on("game_state_update",e=>{console.log("æ”¶åˆ°æ¸¸æˆçŠ¶æ€æ›´æ–°:",e);const r=a.currentRound,v=a.status;switch(Object.assign(a,e),r!==a.currentRound&&_e(a.currentRound),a.status){case h.WAITING:a.statusText="ç­‰å¾…å¼€å§‹";break;case h.STARTING:a.statusText="æ¸¸æˆå¼€å§‹";break;case h.IN_PROGRESS:a.statusText="æ¸¸æˆè¿›è¡Œä¸­";break;case h.FINISHED:a.statusText="æ¸¸æˆç»“æŸ";break;default:a.statusText="æœªçŸ¥çŠ¶æ€"}if(e.players&&ce(e.players),e.playerCards&&Object.assign(H,e.playerCards),a.status===h.FINISHED&&v===h.IN_PROGRESS){const O={winners:a.winner?[a.winner]:[],showdown:e.showdown};Se(O)}}),y.on("api_error",e=>{console.error("APIé”™è¯¯:",e),_(`æ“ä½œå¤±è´¥: ${e.message||"æœªçŸ¥é”™è¯¯"}`)}),y.on("player_joined",e=>{console.log("ç©å®¶åŠ å…¥:",e),_(`${e.username||"ç©å®¶"} åŠ å…¥äº†æ¸¸æˆ`)}),y.on("player_left",e=>{console.log("ç©å®¶ç¦»å¼€:",e),_(`${e.username||"ç©å®¶"} ç¦»å¼€äº†æ¸¸æˆ`)}),y.on("chat_message",e=>{console.log("æ”¶åˆ°èŠå¤©æ¶ˆæ¯:",e),g.addMessage({type:e.isPrivate?"private":"room",content:e.message,senderId:e.userId,senderName:e.username||"ç©å®¶",receiverId:e.recipientId,timestamp:e.timestamp})}),y.on("chat_history",e=>{console.log("æ”¶åˆ°èŠå¤©å†å²:",e),g.clearMessages(),e.forEach(r=>{g.addMessage({type:r.isPrivate?"private":"room",content:r.message,senderId:r.userId,senderName:r.username||"ç©å®¶",receiverId:r.recipientId,timestamp:r.timestamp})})}),y.on("game_action",e=>{console.log("æ”¶åˆ°æ¸¸æˆåŠ¨ä½œ:",e)}),y.on("error",e=>{console.error("WebSocketé”™è¯¯:",e),_(`WebSocketé”™è¯¯: ${e.message||"æœªçŸ¥é”™è¯¯"}`)}),()=>{clearInterval(t),y.off("game_state_update"),y.off("api_error"),y.off("player_joined"),y.off("player_left"),y.off("chat_message"),y.off("chat_history"),y.off("game_action"),y.off("error")}};return me(()=>n.realTime,t=>{t&&n.enabled&&W()}),me(()=>a.communityCards,(t,e)=>{t.some((v,O)=>v.revealed&&(!e[O]||!e[O].revealed))&&n.enabled&&n.realTime&&W()},{deep:!0}),Ge(()=>{Pe(),Z=Ee()}),Le(()=>{Z&&Z(),y.emit("leave_room",{roomId:k}),y.disconnect()}),(t,e)=>{const r=w("van-icon"),v=w("van-button"),O=w("van-image"),ue=w("van-slider"),ae=w("van-tab"),xe=w("van-field"),pe=w("van-switch"),ne=w("van-cell"),Oe=w("van-cell-group"),Te=w("van-tabs");return d(),p("div",We,[s("div",je,[s("div",qe,[s("button",{class:"exit-button",onClick:e[0]||(e[0]=(...i)=>t.handleExitGame&&t.handleExitGame(...i))},[f(r,{name:"arrow-left",size:"20",color:"#fff"}),e[12]||(e[12]=s("span",null,"é€€å‡º",-1))]),s("div",Je,[s("div",Ke,[e[13]||(e[13]=s("span",{class:"label"},"æ¸¸æˆçŠ¶æ€ï¼š",-1)),s("span",Ye,l(a.statusText),1)]),s("div",Qe,[e[14]||(e[14]=s("span",{class:"label"},"è¿æ¥çŠ¶æ€ï¼š",-1)),s("span",{class:N(["value",{connected:A.value,disconnected:!A.value,reconnecting:$.value}])},l(A.value?"å·²è¿æ¥":$.value?"é‡è¿ä¸­...":"å·²æ–­å¼€"),3)]),s("div",Xe,[e[15]||(e[15]=s("span",{class:"label"},"å½“å‰å›åˆï¼š",-1)),s("span",Ze,l(a.currentRoundText),1)]),s("div",es,[e[16]||(e[16]=s("span",{class:"label"},"å½“å‰ç©å®¶ï¼š",-1)),s("span",ss,l(a.currentPlayer),1)])])]),s("div",ts,[s("div",as,[e[17]||(e[17]=s("span",{class:"label"},"åº•æ± ï¼š",-1)),s("span",ns,l(a.pot),1)]),a.status!==h.IN_PROGRESS?(d(),p("div",is,[a.status===h.WAITING||a.status===h.FINISHED?(d(),ve(v,{key:0,size:"small",type:"primary",onClick:ge},{default:S(()=>[...e[18]||(e[18]=[C(" å¼€å§‹æ¸¸æˆ ",-1)])]),_:1})):b("",!0),a.status===h.FINISHED?(d(),ve(v,{key:1,size:"small",type:"success",onClick:be},{default:S(()=>[...e[19]||(e[19]=[C(" é‡æ–°å¼€å§‹ ",-1)])]),_:1})):b("",!0)])):b("",!0)])]),s("div",ls,[s("div",os,[(d(!0),p(j,null,q(L,(i,T)=>(d(),p("div",{key:T,class:N(["player-seat",{active:i.isActive,"current-player":i.isCurrentPlayer,"player-folded":i.player?.status===Y.FOLDED,"player-all-in":i.player?.status===Y.ALL_IN}]),style:Ue(t.getSeatPosition(i.position))},[i.player?(d(),p("div",rs,[s("div",ds,[f(O,{src:i.player.avatar||"https://img.yzcdn.cn/vant/cat.jpeg",round:"",width:"45",height:"45"},null,8,["src"]),s("div",{class:N(["player-status-indicator",i.player.status.toLowerCase()])},null,2)]),s("div",cs,l(i.player.username),1),s("div",us,[s("span",ps,l(i.player.stack),1),e[20]||(e[20]=s("span",{class:"stack-label"},"ç­¹ç ",-1))]),i.player.bet>0?(d(),p("div",ms,[s("span",vs,l(i.player.bet),1),e[21]||(e[21]=s("span",{class:"bet-label"},"ä¸‹æ³¨",-1))])):b("",!0),i.isDealer?(d(),p("div",ys,[...e[22]||(e[22]=[s("span",{class:"badge-icon"},"ğŸ¯",-1)])])):b("",!0),i.isSmallBlind?(d(),p("div",fs,[...e[23]||(e[23]=[s("span",{class:"badge-text"},"SB",-1)])])):b("",!0),i.isBigBlind?(d(),p("div",hs,[...e[24]||(e[24]=[s("span",{class:"badge-text"},"BB",-1)])])):b("",!0),i.player.id!==I.value?(d(),p("div",{key:4,class:"private-chat-button",onClick:jt=>we(i.player.id,i.player.username),title:"å¼€å§‹ç§èŠ"}," ğŸ’¬ ",8,_s)):b("",!0)])):(d(),p("div",gs,[...e[25]||(e[25]=[s("div",{class:"empty-seat-icon"},"+",-1),s("div",{class:"empty-seat-text"},"ç©ºåº§ä½",-1)])]))],6))),128))]),s("div",bs,[(d(!0),p(j,null,q(a.communityCards,(i,T)=>(d(),p("div",{key:T,class:N(["card",{hidden:!i.revealed}])},[i.revealed?(d(),p("div",Ss,[s("div",{class:N(["card-suit",i.suit.toLowerCase()])},l(se(i.suit)),3),s("div",Cs,l(i.value),1),s("div",{class:N(["card-suit bottom-suit",i.suit.toLowerCase()])},l(se(i.suit)),3)])):b("",!0)],2))),128))]),a.status===h.FINISHED?(d(),p("div",ks,[e[28]||(e[28]=s("div",{class:"result-header"},[s("h3",null,"æ¸¸æˆç»“æœ")],-1)),s("div",As,[a.winner?(d(),p("div",ws,[e[26]||(e[26]=s("div",{class:"winner-label"},"è·èƒœè€…:",-1)),s("div",Is,l(a.winner.username),1),s("div",Bs,"èµ¢å¾— "+l(a.pot)+" ç­¹ç ",1)])):b("",!0),a.showdown?(d(),p("div",Rs,[e[27]||(e[27]=s("div",{class:"showdown-title"},"æ‘Šç‰Œä¿¡æ¯:",-1)),(d(!0),p(j,null,q(a.showdown,(i,T)=>(d(),p("div",{class:"player-showdown",key:T},[s("div",Ps,l(i.username),1),s("div",Es,"æ‰‹ç‰Œ: "+l(i.hand.join(", ")),1),s("div",xs,"ç‰Œå‹: "+l(i.rank),1)]))),128))])):b("",!0)])])):b("",!0),s("div",Os,[e[29]||(e[29]=s("div",{class:"pot-label"},"åº•æ± ",-1)),s("div",Ts,l(a.pot),1)])]),s("div",Ns,[e[34]||(e[34]=s("div",{class:"cards-title"},"ä½ çš„æ‰‹ç‰Œ",-1)),s("div",Ms,[(d(!0),p(j,null,q(H,(i,T)=>(d(),p("div",{key:T,class:"card player-card"},[s("div",Ds,[s("div",{class:N(["card-suit",i.suit.toLowerCase()])},l(se(i.suit)),3),s("div",Gs,l(i.value),1)])]))),128))]),n.show?(d(),p("div",Ls,[e[33]||(e[33]=s("div",{class:"analysis-title"},"AIåˆ†æ",-1)),s("div",Hs,[s("div",Us,[e[30]||(e[30]=s("span",{class:"label"},"æ‰‹ç‰Œå¼ºåº¦ï¼š",-1)),s("span",Vs,l(n.handStrength),1)]),s("div",zs,[e[31]||(e[31]=s("span",{class:"label"},"æ¨èæ“ä½œï¼š",-1)),s("span",$s,l(n.recommendedAction),1)]),s("div",Fs,[e[32]||(e[32]=s("span",{class:"label"},"è·èƒœæ¦‚ç‡ï¼š",-1)),s("span",Ws,l(n.winProbability)+"%",1)])])])):b("",!0)]),s("div",js,[s("div",qs,[a.status===h.IN_PROGRESS?(d(),p("div",Js,[f(ue,{modelValue:B.value,"onUpdate:modelValue":e[1]||(e[1]=i=>B.value=i),min:U.value,max:V.value,step:a.bigBlind,onChange:fe,disabled:a.status!==h.IN_PROGRESS},null,8,["modelValue","min","max","step","disabled"])])):b("",!0),s("div",Ks,[e[35]||(e[35]=s("span",{class:"label"},"ä¸‹æ³¨é‡‘é¢ï¼š",-1)),s("span",Ys,l(B.value),1)]),a.status===h.IN_PROGRESS?(d(),p("div",Qs,[s("div",Xs,[e[36]||(e[36]=s("span",{class:"label"},"å½“å‰æœ€é«˜ä¸‹æ³¨ï¼š",-1)),s("span",Zs,l(a.currentBet),1)]),s("div",et,[e[37]||(e[37]=s("span",{class:"label"},"ä½ çš„å·²ä¸‹æ³¨ï¼š",-1)),s("span",st,l(R.value),1)]),s("div",tt,[e[38]||(e[38]=s("span",{class:"label"},"éœ€è¦è·Ÿæ³¨ï¼š",-1)),s("span",at,l(re.value),1)]),s("div",nt,[e[39]||(e[39]=s("span",{class:"label"},"æœ€å°åŠ æ³¨ï¼š",-1)),s("span",it,l(z.value),1)])])):b("",!0),s("div",lt,[f(v,{size:"small",onClick:e[2]||(e[2]=i=>te(re.value)),disabled:!le.value},{default:S(()=>[C(l(F.value?"è¿‡ç‰Œ":"è·Ÿæ³¨"),1)]),_:1},8,["disabled"]),f(v,{size:"small",onClick:e[3]||(e[3]=i=>te(U.value+z.value)),disabled:!oe.value},{default:S(()=>[C(" åŠ æ³¨ ("+l(z.value)+") ",1)]),_:1},8,["disabled"]),f(v,{size:"small",onClick:e[4]||(e[4]=i=>te(V.value))},{default:S(()=>[...e[40]||(e[40]=[C(" å…¨æŠ¼ ",-1)])]),_:1})])]),s("div",ot,[f(v,{type:"default",block:"",onClick:Ce},{default:S(()=>[...e[41]||(e[41]=[C(" å¼ƒç‰Œ ",-1)])]),_:1}),f(v,{type:"primary",block:"",onClick:ke,disabled:!le.value},{default:S(()=>[C(l(F.value?"è¿‡ç‰Œ":"è·Ÿæ³¨"),1)]),_:1},8,["disabled"]),f(v,{type:"success",block:"",onClick:Ae,disabled:!oe.value},{default:S(()=>[...e[42]||(e[42]=[C(" åŠ æ³¨ ",-1)])]),_:1},8,["disabled"])])]),s("div",rt,[f(Te,{active:ee.value,"onUpdate:active":e[11]||(e[11]=i=>ee.value=i)},{default:S(()=>[f(ae,{title:"æ¸¸æˆ"}),f(ae,{title:"èŠå¤©"},{default:S(()=>[s("div",dt,[s("div",ct,[f(v,{size:"small",type:E(g).chatType==="room"?"primary":"default",onClick:e[5]||(e[5]=i=>E(g).setChatType("room"))},{default:S(()=>[...e[43]||(e[43]=[C(" æˆ¿é—´èŠå¤© ",-1)])]),_:1},8,["type"]),f(v,{size:"small",type:E(g).chatType==="private"?"primary":"default",disabled:!E(g).privateChatUserId,onClick:e[6]||(e[6]=i=>E(g).setChatType("private"))},{default:S(()=>[...e[44]||(e[44]=[C(" ç§èŠ ",-1)])]),_:1},8,["type","disabled"])]),s("div",ut,[(d(!0),p(j,null,q(E(g).getLatestMessages(50),(i,T)=>(d(),p("div",{key:i.id,class:N(["chat-message",{"own-message":i.senderId===I.value,"private-message":i.type==="private"}])},[s("div",pt,[s("div",mt,[s("div",vt,l(i.senderName),1),s("div",yt,l(new Date(i.timestamp).toLocaleTimeString()),1)]),s("div",ft,l(i.content),1),i.type==="private"?(d(),p("div",ht,"ç§èŠ")):b("",!0)])],2))),128))]),s("div",_t,[f(xe,{modelValue:E(g).inputMessage,"onUpdate:modelValue":e[7]||(e[7]=i=>E(g).inputMessage=i),placeholder:E(g).chatType==="private"?"è¾“å…¥ç§èŠæ¶ˆæ¯...":"è¾“å…¥æˆ¿é—´æ¶ˆæ¯...","right-icon":"send",onClickRightIcon:de,onKeyup:Ve(de,["enter"])},null,8,["modelValue","placeholder"])])])]),_:1}),f(ae,{title:"AIè¾…åŠ©"},{default:S(()=>[s("div",gt,[s("div",bt,[f(Oe,{inset:""},{default:S(()=>[f(ne,{title:"AIè¾…åŠ©å¼€å…³"},{"right-icon":S(()=>[f(pe,{modelValue:n.enabled,"onUpdate:modelValue":e[8]||(e[8]=i=>n.enabled=i),size:"24px",onChange:Ie},null,8,["modelValue"])]),_:1}),f(ne,{title:"å®æ—¶åˆ†æ"},{"right-icon":S(()=>[f(pe,{modelValue:n.realTime,"onUpdate:modelValue":e[9]||(e[9]=i=>n.realTime=i),size:"24px"},null,8,["modelValue"])]),_:1}),f(ne,{title:"å»ºè®®å¼ºåº¦"},{"right-icon":S(()=>[f(ue,{modelValue:n.adviceStrength,"onUpdate:modelValue":e[10]||(e[10]=i=>n.adviceStrength=i),min:"1",max:"5",step:"1"},null,8,["modelValue"])]),_:1})]),_:1}),f(v,{type:"primary",block:"",onClick:W,loading:n.loading,style:{"margin-top":"10px"}},{default:S(()=>[...e[45]||(e[45]=[C(" è¯·æ±‚AIåˆ†æ ",-1)])]),_:1},8,["loading"])]),n.show?(d(),p("div",St,[s("div",Ct,[e[57]||(e[57]=s("div",{class:"card-title"},"å½“å‰æ‰‹ç‰Œåˆ†æ",-1)),s("div",kt,[s("div",At,[e[46]||(e[46]=s("span",{class:"item-label"},"æ‰‹ç‰Œç»„åˆï¼š",-1)),s("span",wt,l(n.handCombination),1)]),s("div",It,[e[47]||(e[47]=s("span",{class:"item-label"},"æ‰‹ç‰Œå¼ºåº¦ï¼š",-1)),s("span",Bt,l(n.handStrength),1)]),s("div",Rt,[e[48]||(e[48]=s("span",{class:"item-label"},"è·èƒœæ¦‚ç‡ï¼š",-1)),s("span",Pt,l(n.winProbability)+"%",1)]),s("div",Et,[e[49]||(e[49]=s("span",{class:"item-label"},"åº•æ± èµ”ç‡ï¼š",-1)),s("span",xt,l(n.potOdds),1)]),s("div",Ot,[e[50]||(e[50]=s("span",{class:"item-label"},"ç‰ŒåŠ› equityï¼š",-1)),s("span",Tt,l(n.equity),1)]),s("div",Nt,[e[51]||(e[51]=s("span",{class:"item-label"},"æ¨èæ“ä½œï¼š",-1)),s("span",Mt,l(n.recommendedAction),1)]),n.explanation?(d(),p("div",Dt,[e[52]||(e[52]=s("span",{class:"explanation-label"},"åˆ†æè¯´æ˜ï¼š",-1)),s("span",Gt,l(n.explanation),1)])):b("",!0),n.opponentAnalysis?(d(),p("div",Lt,[e[56]||(e[56]=s("div",{class:"opponent-title"},"å¯¹æ‰‹åˆ†æ",-1)),s("div",Ht,[e[53]||(e[53]=s("span",{class:"item-label"},"å¯¹æ‰‹ï¼š",-1)),s("span",Ut,l(n.opponentAnalysis.opponentName),1)]),s("div",Vt,[e[54]||(e[54]=s("span",{class:"item-label"},"æ‰“æ³•é£æ ¼ï¼š",-1)),s("span",zt,l(n.opponentAnalysis.playingStyle),1)]),s("div",$t,[e[55]||(e[55]=s("span",{class:"item-label"},"æ”»å‡»å€¾å‘ï¼š",-1)),s("span",Ft,l(n.opponentAnalysis.aggressionLevel),1)])])):b("",!0)])])])):b("",!0)])]),_:1})]),_:1},8,["active"])])])}}},Xt=Me(Wt,[["__scopeId","data-v-993d9503"]]);export{Xt as default};
