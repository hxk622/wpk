import{_ as U,r as t,o as $,c,a as n,d as l,w as g,s as w,g as D,h as d,F as k,f as x,b as s,t as i,j as R,k as E,l as J}from"./index-DuysnCwA.js";import{r as C}from"./room-MDMjkgn2.js";import"./axios-DCPBCOZw.js";import"./logger-BnKYzyre.js";const M={class:"rooms"},P=["onClick"],q={class:"room-header"},G={class:"room-name"},H={class:"room-info"},I={class:"room-player-count"},K={class:"room-blinds"},O={class:"room-players"},Q="https://img.yzcdn.cn/vant/cat.jpeg",W={__name:"RoomsView",setup(X){const u=D(),r=t([]),v=t(!1),_=t(!1),p=t(!1),m=t(1),y=t(10),f=async(o=!1)=>{try{o&&(m.value=1,r.value=[],p.value=!1);const e=await C.getRooms({page:m.value,pageSize:y.value});o?r.value=e.rooms:r.value=[...r.value,...e.rooms],m.value++,e.rooms.length<y.value&&(p.value=!0)}catch(e){console.error("获取房间列表失败:",e),w(e.message||"获取房间列表失败")}finally{v.value=!1,_.value=!1}},V=()=>{f(!1)},b=()=>{f(!0)};$(()=>{f(!0)});const B=()=>{u.push("/")},L=()=>{u.push("/create-room")},T=async o=>{try{E({message:"正在加入房间...",forbidClick:!0}),await C.joinRoom(o),u.push(`/room/${o}`)}catch(e){console.error("加入房间失败:",e),w(e.message||"加入房间失败，请稍后重试")}finally{J()}};return(o,e)=>{const j=l("van-nav-bar"),z=l("van-tag"),N=l("van-icon"),S=l("van-image"),A=l("van-list"),F=l("van-pull-refresh");return d(),c("div",M,[n(j,{title:"游戏房间","left-arrow":"",onClickLeft:B,"right-text":"创建",onClickRight:L}),n(F,{modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=a=>_.value=a),onRefresh:b},{default:g(()=>[n(A,{loading:v.value,"onUpdate:loading":e[0]||(e[0]=a=>v.value=a),finished:p.value,"finished-text":"没有更多房间了",onLoad:V},{default:g(()=>[(d(!0),c(k,null,x(r.value,a=>(d(),c("div",{class:"room-item",key:a.id,onClick:h=>T(a.id)},[s("div",q,[s("div",G,"房间 "+i(a.id),1),n(z,{type:a.status==="waiting"?"primary":"success"},{default:g(()=>[R(i(a.status==="waiting"?"等待中":"游戏中"),1)]),_:2},1032,["type"])]),s("div",H,[s("div",I,[n(N,{name:"friends-o"}),R(" "+i(a.players.length)+"/"+i(a.maxPlayers)+"人 ",1)]),s("div",K,[s("span",null,"小盲: "+i(a.smallBlind),1),s("span",null,"大盲: "+i(a.bigBlind),1)])]),s("div",O,[(d(!0),c(k,null,x(a.players,(h,Y)=>(d(),c("div",{key:h.id,class:"player-avatar"},[n(S,{round:"",src:h.avatar||Q,width:"30px",height:"30px"},null,8,["src"])]))),128))])],8,P))),128))]),_:1},8,["loading","finished"])]),_:1},8,["modelValue"])])}}},oe=U(W,[["__scopeId","data-v-8f50d3c2"]]);export{oe as default};
